<!DOCTYPE html>
<html lang="en">
    <head>
        <!--Root server initialization-src="https://theblooger.lovestoblog.com/js/api.js"-->
        <script>
            window.apiConfig = {
                apiKey: "4fc84cbec6351f5a1bed55af50880fd4dc96f96c0ac56aa0c11882ef71c19627"
            };
        </script>
        <script >
           async function get_data2(postId){
                if(postId == "undefined"){
                const urlParams = new URLSearchParams(window.location.search);
                postId = urlParams.get('id');
                
                }
                var output = document.querySelector(".output");
                output.innerHTML = "Loading...";
            
                
                const params = window.location.search;
                console.log(params.split('?')[1]);
                const url = `https://theblooger.lovestoblog.com/api/posts/${postId}/html`;

                fetch(url, {
                            method: 'GET',
                          
                            //body : JSON.stringify({'urlParams' : params})
                }).then(function(response){
                    console.log('Status:', response.status);
                    console.log('Headers:', [...response.headers.entries()]);
                    //alert(urlParams);
                    //output.innerHTML = response.json();
                    typeReturned = response.headers.get('content-type');
                    if(typeReturned == "application/json"){
                        return response.json();
                    }else{
                        return response.text();
                    }
                    return response.text();
            
                }).then(function(data){
                    // alert(typeReturned);
                    if(typeReturned == "application/json" || typeReturned == "application/json;charset=utf-8"){
                        var obj = JSON.parse(data);
                        //alert(obj.status);
                        if(obj.status == "error"){
                            document.documentElement.innerHTML = obj.message;
                        }else{
                            document.documentElement.innerHTML = "success";
                        }
                    }else{
            
                        typeReturned = null;
                        document.documentElement.innerHTML = data;
                       
                        const scripts = document.documentElement.querySelectorAll("script");
                        scripts.forEach((script) => {
                            const newScript = document.createElement("script");
                            if (script.src) {
                                // If the script has a src attribute, load it
                                newScript.src = script.src;
                            } else {
                                // Otherwise, copy the inline script content
                                newScript.textContent = script.textContent;
                            }
                            document.body.appendChild(newScript); // Append the script to the body
                        });
                    }
            
                }).catch(function(error){
                    output.innerHTML = error;
            
                });

            }
                // Automatically call get_data2 when the page loads
            window.onload = function() {
                const urlParams = new URLSearchParams(window.location.search);
                const postId = urlParams.get('id');
                 
                API_KEY = window.apiConfig.apiKey;
                if (!API_KEY) {
                    alert("API_KEY is not defined in window.apiConfig click the link to read the documentation ");
                    var data = {};
                    data.status = "error";
                    data.message = "Unauthorized server. If you are a visitor, <a href='http://localhost/blooger/one_blog.php?id="+postId+"'> click here </a> to read this blog on the Blooger Servers <br> if you are a the server owner here is the exact error generated: API_KEY is not defined in window.apiConfig click the link to read the documentation on <a href='http://localhost/blooger/api_docs.php'>Blooger API</a>";
                    console.log(data);
                    console.error("API_KEY is not defined in window.apiConfig");
                    var output = document.querySelector(".output");
                    output.innerHTML =  data.message;
                    return;
                }
                if (postId) {
                    get_data2(postId);
                }
            };
        </script>
        <!--Freind server details-->
        <meta charset="UTF-8">
        <link rel="shortcut icon" href="https://theblooger.lovestoblog.com/assets/logo/logobc.gif" type="image/svg+xml">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Blooger | Friend</title>
    </head>
    <body style = "background-color:aqua;">
        Output
        <div style = "width:100%; max-width:600px; margin:auto;">
            <!--Outputs from the server-->
            <div class="output"></div>
        </div>
    </body>
</html>
